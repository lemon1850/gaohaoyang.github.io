
---
layout: post
title: mysql零碎知识整理
categories: mysql
tags:  mysql
---

* content
{:toc}

> 我的技术博客，主要是记载看过的书以及对写的好的博客文章的搬运整理，方便自己他人查看，也方便别人指出我文章中的错误，达到一起学习的目的。
> 技术永无止境

本文主要是对mysql零碎知识的整理，方便遗忘时查看



## 关于时间戳

当我们需要创建一列来记载记录这条记录的创建时间，我们在mysql可以这样子配置`timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP`


```sql
CREATE TABLE `test` (
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(444) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=latin1;;

```

当我们需要在插入以及每次更新记录时更新这条记录的时间，我们可以用`timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP`


```sql
CREATE TABLE `fddfdf` (
  `fff` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(444) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=latin1;

```


如果使用的是navicate,选择timestamp字段，就会在插入时，默认当前时间错，如果勾选了`ON UPDATE CURRENT_TIMESTAMP`,则会在插入和更新每次都会更新新的值。


## replace与insert ... on deplicate update

（1），没有key的时候，replace与insert .. on deplicate udpate相同。 （2），有key的时候，都保留主键值，并且auto_increment自动+1 不同之处：有key的时候，replace是delete老记录，而录入新的记录，所以原有的所有记录会被清除，这个时候，如果replace语句的字段不全的话，有些原有的比如例子中c字段的值会被自动填充为默认值。       而insert .. deplicate update则只执行update标记之后的sql，从表象上来看相当于一个简单的update语句。       但是实际上，根据我推测，如果是简单的update语句，auto_increment不会+1，应该也是先delete，再insert的操作，只是在insert的过程中保留除update后面字段以外的所有字段的值。
 所以两者的区别只有一个，insert .. on deplicate udpate保留了所有字段的旧值，再覆盖然后一起insert进去，而replace没有保留旧值，直接删除再insert新值。  从底层执行效率上来讲，replace要比insert .. on deplicate update效率要高，但是在写replace的时候，字段要写全，防止老的字段数据被删除。

## 类型装换

Cast(filed as newType) 转换类型
str_to_date(str, '%Y-%m-%d’) 字符串转日期
date_to_format   日期转字符串


![](2017-09-08-mysql/1F749CA25115438F26318E8777210764.jpg)

![](2017-09-08-mysql/A934811E4A9F4CE1A858C982A6C1C49B.jpg)
